<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities for handling surfaces, subsurfaces and regions"><meta name="keywords" content="rust, rustlang, rust-lang, compositor"><title>smithay::wayland::compositor - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../smithay/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module compositor</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="compositor" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">smithay</a>::<wbr><a href="../index.html">wayland</a>::<wbr><a class="mod" href="#">compositor</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/smithay/wayland/compositor/mod.rs.html#1-503" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities for handling surfaces, subsurfaces and regions</p>
<p>This module provides automatic handling of surfaces, subsurfaces
and region Wayland objects, by registering an implementation for
for the <a href="../../../wayland_server/protocol/wl_compositor/index.html"><code>wl_compositor</code></a>
and <a href="../../../wayland_server/protocol/wl_subcompositor/index.html"><code>wl_subcompositor</code></a> globals.</p>
<h3 id="why-use-this-implementation" class="section-header"><a href="#why-use-this-implementation">Why use this implementation</a></h3>
<p>This implementation does a simple job: it stores in a coherent way the state of
surface trees with subsurfaces, to provide you direct access to the tree
structure and all surface attributes, and handles the application of double-buffered
state.</p>
<p>As such, you can, given a root surface with a role requiring it to be displayed,
you can iterate over the whole tree of subsurfaces to recover all the metadata you
need to display the subsurface tree.</p>
<p>This implementation will not do anything more than present you the metadata specified by the
client in a coherent and practical way. All the logic regarding drawing itself, and
the positioning of windows (surface trees) one relative to another is out of its scope.</p>
<h3 id="how-to-use-it" class="section-header"><a href="#how-to-use-it">How to use it</a></h3><h4 id="initialization" class="section-header"><a href="#initialization">Initialization</a></h4>
<p>To initialize this implementation, use the <a href="fn.compositor_init.html" title="compositor_init"><code>compositor_init</code></a>
method provided by this module. It’ll require you to first define as few things, as shown in
this example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">smithay::wayland::compositor::compositor_init</span>;

<span class="comment">// Call the init function:</span>
<span class="ident">compositor_init</span>(
    <span class="kw-2">&amp;mut</span> <span class="ident">display</span>,
    <span class="op">|</span><span class="ident">surface</span>, <span class="ident">dispatch_data</span><span class="op">|</span> {
        <span class="comment">/*
          Your handling of surface commits
         */</span>
    },
    <span class="prelude-val">None</span> <span class="comment">// put a logger here</span>
);

<span class="comment">// You&#39;re now ready to go!</span></code></pre></div>
<h4 id="use-the-surface-states" class="section-header"><a href="#use-the-surface-states">Use the surface states</a></h4>
<p>The main access to surface states is done through the <a href="fn.with_states.html" title="with_states"><code>with_states</code></a> function, which
gives you access to the <a href="struct.SurfaceData.html" title="SurfaceData"><code>SurfaceData</code></a> instance associated with this surface. It acts
as a general purpose container for associating state to a surface, double-buffered or
not. See its documentation for more details.</p>
<h4 id="state-application-and-hooks" class="section-header"><a href="#state-application-and-hooks">State application and hooks</a></h4>
<p>On commit of a surface several steps are taken to update the state of the surface. Actions
are taken by smithay in the following order:</p>
<ol>
<li>Commit hooks registered to this surface are invoked. Such hooks can be registered using
the <a href="fn.add_commit_hook.html" title="add_commit_hook"><code>add_commit_hook</code></a> function. They are typically used by protocol extensions that
add state to a surface and need to check on commit that client did not request an
illegal state before it is applied on commit.</li>
<li>The pending state is either applied and made current, or cached for later application
is the surface is a synchronize subsurface. If the current state is applied, state
of the synchronized children subsurface are applied as well at this point.</li>
<li>Your user callback provided to <a href="fn.compositor_init.html" title="compositor_init"><code>compositor_init</code></a> is invoked, so that you can access
the new current state of the surface. The state of sync children subsurfaces of your
surface may have changed as well, so this is the place to check it, using functions
like <a href="fn.with_surface_tree_upward.html" title="with_surface_tree_upward"><code>with_surface_tree_upward</code></a> or <a href="fn.with_surface_tree_downward.html" title="with_surface_tree_downward"><code>with_surface_tree_downward</code></a>. On the other hand,
if the surface is a sync subsurface, its current state will note have changed as
the result of that commit. You can check if it is using <a href="fn.is_sync_subsurface.html" title="is_sync_subsurface"><code>is_sync_subsurface</code></a>.</li>
</ol>
<h4 id="surface-roles" class="section-header"><a href="#surface-roles">Surface roles</a></h4>
<p>The wayland protocol specifies that a surface needs to be assigned a role before it can
be displayed. Furthermore, a surface can only have a single role during its whole lifetime.
Smithay represents this role as a <code>&amp;'static str</code> identifier, that can only be set once
on a surface. See <a href="fn.give_role.html" title="give_role"><code>give_role</code></a> and <a href="fn.get_role.html" title="get_role"><code>get_role</code></a> for details. This module manages the
subsurface role, which is identified by the string <code>&quot;subsurface&quot;</code>.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AlreadyHasRole.html" title="smithay::wayland::compositor::AlreadyHasRole struct">AlreadyHasRole</a></div><div class="item-right docblock-short"><p>An error type signifying that the surface already has a role and
cannot be assigned an other</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MultiCache.html" title="smithay::wayland::compositor::MultiCache struct">MultiCache</a></div><div class="item-right docblock-short"><p>A typemap-like container for double-buffered values</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RegionAttributes.html" title="smithay::wayland::compositor::RegionAttributes struct">RegionAttributes</a></div><div class="item-right docblock-short"><p>Description of the contents of a region</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SubsurfaceCachedState.html" title="smithay::wayland::compositor::SubsurfaceCachedState struct">SubsurfaceCachedState</a></div><div class="item-right docblock-short"><p>The cached state associated with a subsurface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SurfaceAttributes.html" title="smithay::wayland::compositor::SurfaceAttributes struct">SurfaceAttributes</a></div><div class="item-right docblock-short"><p>General state associated with a surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SurfaceData.html" title="smithay::wayland::compositor::SurfaceData struct">SurfaceData</a></div><div class="item-right docblock-short"><p>The state container associated with a surface</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.BufferAssignment.html" title="smithay::wayland::compositor::BufferAssignment enum">BufferAssignment</a></div><div class="item-right docblock-short"><p>New buffer assignation for a surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Damage.html" title="smithay::wayland::compositor::Damage enum">Damage</a></div><div class="item-right docblock-short"><p>Description of a part of a surface that
should be considered damaged and needs to be redrawn</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.RectangleKind.html" title="smithay::wayland::compositor::RectangleKind enum">RectangleKind</a></div><div class="item-right docblock-short"><p>Kind of a rectangle part of a region</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TraversalAction.html" title="smithay::wayland::compositor::TraversalAction enum">TraversalAction</a></div><div class="item-right docblock-short"><p>Possible actions to do after handling a node during tree traversal</p>
</div></div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Cacheable.html" title="smithay::wayland::compositor::Cacheable trait">Cacheable</a></div><div class="item-right docblock-short"><p>Trait representing a value that can be used in double-buffered storage</p>
</div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.add_commit_hook.html" title="smithay::wayland::compositor::add_commit_hook fn">add_commit_hook</a></div><div class="item-right docblock-short"><p>Register a commit hook to be invoked on surface commit</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.compositor_init.html" title="smithay::wayland::compositor::compositor_init fn">compositor_init</a></div><div class="item-right docblock-short"><p>Create new <a href="../../../wayland_server/protocol/wl_compositor/index.html"><code>wl_compositor</code></a>
and <a href="../../../wayland_server/protocol/wl_subcompositor/index.html"><code>wl_subcompositor</code></a> globals.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_children.html" title="smithay::wayland::compositor::get_children fn">get_children</a></div><div class="item-right docblock-short"><p>Retrieve the children of this surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_parent.html" title="smithay::wayland::compositor::get_parent fn">get_parent</a></div><div class="item-right docblock-short"><p>Retrieve the parent of this surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_region_attributes.html" title="smithay::wayland::compositor::get_region_attributes fn">get_region_attributes</a></div><div class="item-right docblock-short"><p>Retrieve the metadata associated with a <code>wl_region</code></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_role.html" title="smithay::wayland::compositor::get_role fn">get_role</a></div><div class="item-right docblock-short"><p>Get the current role of this surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.give_role.html" title="smithay::wayland::compositor::give_role fn">give_role</a></div><div class="item-right docblock-short"><p>Register that this surface has given role</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.is_sync_subsurface.html" title="smithay::wayland::compositor::is_sync_subsurface fn">is_sync_subsurface</a></div><div class="item-right docblock-short"><p>Check if this subsurface is a synchronized subsurface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.with_states.html" title="smithay::wayland::compositor::with_states fn">with_states</a></div><div class="item-right docblock-short"><p>Access the states associated to this surface</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.with_surface_tree_downward.html" title="smithay::wayland::compositor::with_surface_tree_downward fn">with_surface_tree_downward</a></div><div class="item-right docblock-short"><p>Access the data of a surface tree from top to bottom</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.with_surface_tree_upward.html" title="smithay::wayland::compositor::with_surface_tree_upward fn">with_surface_tree_upward</a></div><div class="item-right docblock-short"><p>Access the data of a surface tree from bottom to top</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="smithay" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
    <script src="../../../main.js"></script>
</body></html>